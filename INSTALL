Requirements posed upon the user:

In this document,with user, we mean *you*, the person that downloads,
configures and installs Confusa on a server.

You should have
- some experience with Apache-configuration
- basic knowledge about cryptography (i.e. what a certificate is, and
  how it's used) but not much more is required.
- some, but not excessive, knowledge about PHP and bash-scripting, as
  this will help both *you* and *us* to track down bugs
- an open and positive mind (for a more pleasent interaction with the
  world as a whole). This has nothing to do with Confusa

To install Confusa

=== Requirements: ===
 - git (for latest checkout of confusa source code). *not* required, but handy
 - svn (for latest simplesamlphp checkout). *not* required, but handy
 - Apache2
 - PHP5
 - PEAR with MDB2.MySQL
 - 
=== Install process ===
1) Install Apache2 with PHP5 support.
2) Install mysql5
3) Install php5-mysql and PEAR::MDB2_mysql_driver
4) Configure Apache to use SSL, use the following lines in your 
   apache2/sites-enabled/appropriate.config.file and php5-openssl

# Redirect http to https
<VirtualHost your.host.org:80>
        Servername your.server.org
        Redirect permanent / https://your.host.org
</VirtualHost>

<VirtualHost your.host.org:443>
        Servername your.server.org
        SSLEngine On
        SSLProtocol All
        SSLCipherSuite ALL:!ADH:!EXPORT56:!EXPORT40:RC4+RSA:!SSLv2:+HIGH:+MEDIUM:+LOW:+EXP
        SSLVerifyClient optional_no_ca
        SSLVerifyDepth 10
        SSLOptions +StdEnvVars +ExportCertData
        SSLCertificateFile /etc/apache2/ssl/slcstest.crt
        SSLCertificateKeyFile /etc/apache2/ssl/slcstest.key

	...
</VirtualHost>

Note that ServerName can be the same as the host-name in VirtualHost.
Make sure you create the folder /etc/apache2/ssl/ as the create-ca.sh
will put hostkeys there for you (a self-signed certificate, you should
get a properly signed certificate for any production-grade instances of
Confusa!).

Alternatively, if you don't want to use this script, put the
key/certificate in the folder of your choice and configure the 2 lines
in the given config-file.

Finally, this is a *sample* configuration. If you know your way around
an Apache configuration, this should be more of a guideline than
anything else. 

5) simpleSAMLphp
   confusa uses simpleSAMLphp to handle AuthN, and thus, you should
   configure simpleSAMLphp before venturing on.

   http://rnd.feide.no contains excellent guides on how to configure
   simpelSAMLphp, and is required reading.

   IN saml20-sp-hosted.php, let the __DYNAMIC:1-entry from template
   stay, but add 2 lines:
	'attributealter' => 'names',
	ForceAuthn	 => true

   This passes the attributes through the file names.php (which you
   hopefully symlinked in prevously).

6) Install and configure Confusa:

a) Put Confusa in a directory, say /var/www/confusa/

b) Configure Apache with something along the following line:

             Alias /confusa "/var/www/confusa/www/"
	     Alias /simplesaml "/var/www/simplesamlphp/www/"
             <Directory /var/www/confusa/www>
                        Options Indexes MultiViews
                        AllowOverride None
                        Order allow,deny
                        Allow from all
             </Directory>

   then reload the config: /etc/init.d/apache2 reload (or httpd (or
   other relevant name for apache - consult your distro's documentation)
   and reaload.

   This will enable your host to show the www directory of the
   confusa-folder.

c) Configure the confusa_config.php file (copy the
   confusa_config_template.php and modify with values that makes sense
   to you - the template explaines the attributes).
   
d) Run the create_database.sh script in confusa/init folder
   This will create the database, the user and the tables. it will use
   the confusa_config.php file, so make sure that this is configured
   properly before you run this script.

e) Add a cron-job of the following type:
   */5 *   * * * /var/www/confusa/programs/clean_db.sh

   This will run the clean_db script every 5 minutes and keep the
   database nice and tidy.

f) Add a cron-job that takes backup of the database. The most critical
   part is the certificate hash part.
   A sample script lies in confusa/programs. Note that this is a simple
   mysqldump script that dumps the database specified in confusa_config

7) Test and verify that the system is operational before you allow
   public access.
